# 技术笔记：EDA 专用术语词典对检索的影响 (Technical Note: Impact of EDA Lexicon)

**日期**: 2026-02-12
**主题**: 混合检索优化、分词策略、性能分析

---

## 1. 核心问题：为什么需要专用词典？

在 EDA (Electronic Design Automation) 领域，存在大量特定的**长组合词命令**（如 `set_placement_ir_drop_target`）和**专业术语**（如 `fusion_compiler`）。

### 生效机制对比

| 场景               | **没有** `eda_terms.txt` (默认分词)                                     | **有** `eda_terms.txt` (专用词典)                         | **关键差别**   |
| :----------------- | :---------------------------------------------------------------------- | :-------------------------------------------------------- | :------------- |
| **查询 Query**     | `set_placement_ir_drop_target`                                          | `set_placement_ir_drop_target`                            |                |
| **jieba 分词结果** | `['set', 'placement', 'ir', 'drop', 'target']`                          | `['set_placement_ir_drop_target']`                        | **词条完整性** |
| **BM25 匹配逻辑**  | 文档需包含这 5 个分散单词；<br>单词距离越近分数越高，但**不强制连续**。 | 文档必须**精确包含**该完整字符串产生的 Token 才能命中。   |                |
| **检索结果**       | ❌ **噪音大**：可能召回只包含 `set_placement` 或无关 `drop` 的文档。     | ✅ **精准召回**：精准定位该命令的定义/用法章节，排除干扰。 |                |

> **结论**：专用词典通过防止“过度切分”，将 BM25 从“模糊的单词匹配”提升为“精确的术语匹配”，准确率大幅提升。

---

## 2. 性能分析：数量过多是否影响速度？

**结论：几乎不会影响性能，甚至可能略微提升分词效率。**

### 2.1 加载阶段 (Initialization)
- **机制**：Python 的 `jieba.load_userdict()` 是一次性操作。
- **耗时**：加载 1万-10万个词通常只需要 **几百毫秒**。
- **现状**：目前 `eda_terms.txt` 约 **1000 个词**，加载耗时 **< 0.1秒**，对系统启动时间的影响可忽略不计。

### 2.2 分词阶段 (Runtime Tokenization)
- **算法**：jieba 使用基于 **前缀树 (Trie Tree)** 的高效扫描算法。
- **复杂度**：增加词典词条，本质上只是在前缀树上增加了分支节点。分词的时间复杂度主要取决于**待处理句子的长度**，而非词典的大小。
- **效率**：
    - **正向影响**：词典越丰富，能匹配到的长词越多（如直接匹配 `set_app_options` 这一整体），反而减少了算法回溯和处理碎片词（如分别处理 `set`, `app`, `options`）的次数。
    - **负向影响**：微乎其微。

---

## 3. 最佳实践建议

1.  **质量 > 数量**：
    - ✅ 收录：`signoff_create_metal_fill` (EDA 专有长指令)
    - ❌ 拒收：`file`, `set`, `get` (高频通用短词，收录后可能导致分词过死)

2.  **定期更新**：
    - 建议每季度运行一次 `extract_eda_terms.py` 脚本，从最新的文档库中挖掘新出现的术语。

3.  **权重配合**：
    - 当识别到 Query 包含词典中的术语时，应动态调高 BM25 的检索权重（目前系统已实现：命中 EDA 术语时 BM25 权重提升至 0.7）。
